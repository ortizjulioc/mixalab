[variables]
PORT = "3001"

[phases.setup]
# Cambiamos a nodejs-23 para superar con seguridad el requisito de Prisma 22.12+
nixPkgs = ["nodejs_23"]

[phases.install]
cmds = ["npm install --legacy-peer-deps"]

[phases.build]
# Generamos prisma antes del build
cmds = ["npx prisma generate", "npm run build"]

[start]
cmd = "npm start -- -H 0.0.0.0 -p ${PORT:-3001}"